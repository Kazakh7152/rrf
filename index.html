<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∑–ª–æ–º - –î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞ –ú–∞—Ç—Ä–∏—Ü—ã (2 –º–∏–Ω—É—Ç—ã)</title>
    
    <style>
        body {
            font-family: 'Consolas', monospace;
            background-color: #1a1a2e;
            color: #00ff00; /* –ó–µ–ª–µ–Ω—ã–π "—Ö–∞–∫–µ—Ä—Å–∫–∏–π" —Ç–µ–∫—Å—Ç */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background-color: #0f0f1a;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(0, 255, 0, 0.7);
            width: 90%;
            max-width: 650px;
            border: 2px solid #00ff00;
        }

        h1, h2 {
            text-align: center;
            color: #00ffff; /* –ì–æ–ª—É–±–æ–π –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ */
            text-shadow: 0 0 5px #00ffff;
        }
        
        hr {
            border: 0;
            height: 1px;
            background-image: linear-gradient(to right, #1a1a2e, #00ff00, #1a1a2e);
            margin: 20px 0;
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
        .progress-area {
            margin-bottom: 25px;
        }

        #progressBarContainer {
            width: 100%;
            background-color: #333;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #00ff00;
        }

        #progressBar {
            height: 35px;
            line-height: 35px;
            text-align: center;
            background-color: #00ff00;
            transition: width 0.4s ease-in-out;
            font-weight: bold;
            color: #1a1a2e;
            font-size: 1.1em;
            text-shadow: none;
        }

        /* –û–±—â–∏–π –¢–∞–π–º–µ—Ä */
        .timer-area {
            text-align: center;
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        #globalTimer {
            color: #ffcc00; /* –ñ–µ–ª—Ç—ã–π –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ */
            font-weight: bold;
        }

        /* –ú–∏–Ω–∏-–ò–≥—Ä–∞ */
        .game-area p {
            font-size: 1.1em;
            margin: 8px 0;
        }

        #targetSequence {
            color: #ff00ff; /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è —Ü–µ–ª–∏ */
            font-size: 1.2em;
            font-weight: bold;
        }
        
        #playerInput {
            color: #ffffff; /* –ë–µ–ª—ã–π –¥–ª—è –≤–≤–æ–¥–∞ */
            font-size: 1.2em;
            font-weight: bold;
        }

        #roundTimer {
            color: #ff6600; /* –û—Ä–∞–Ω–∂–µ–≤—ã–π –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞—É–Ω–¥–∞ */
        }

        .message {
            text-align: center;
            font-weight: bold;
            font-size: 1.3em;
            min-height: 1.3em;
            margin-top: 15px;
        }

        /* –°–µ—Ç–∫–∞ –ú–∞—Ç—Ä–∏—Ü—ã */
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 20px;
        }

        .matrix-cell {
            background-color: #3a3a4a;
            padding: 15px 0;
            text-align: center;
            font-size: 28px;
            border: 2px solid #00ff00;
            cursor: pointer;
            transition: background-color 0.1s, box-shadow 0.1s;
            user-select: none;
            border-radius: 5px;
        }

        .matrix-cell:hover {
            background-color: #5a5a6a;
            box-shadow: 0 0 10px #00ffff;
        }

        .matrix-cell:active {
            background-color: #00ff00;
            color: #1a1a2e;
            box-shadow: 0 0 15px #00ff00;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (–§–∏–Ω–∞–ª) */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-content {
            background-color: #0f0f1a;
            color: #00ff00;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 0 50px rgba(0, 255, 0, 1);
            border: 5px double #00ff00;
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            from { box-shadow: 0 0 30px rgba(0, 255, 0, 0.7); }
            to { box-shadow: 0 0 50px rgba(0, 255, 0, 1); }
        }

        .modal-content h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .secret-word {
            font-size: 1.5em;
            color: #ff00ff;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üîê –û–ø–µ—Ä–∞—Ü–∏—è "–í–∫–ª—é—á–µ–Ω–∏–µ –í—ã—à–∫–∏"</h1>
        
        <div class="timer-area">
            <h2>–û–±—â–µ–µ –û—Å—Ç–∞–≤—à–µ–µ—Å—è –í—Ä–µ–º—è: <span id="globalTimer">120</span> —Å</h2>
        </div>
        
        <div class="progress-area">
            <h2>–ü—Ä–æ–≥—Ä–µ—Å—Å –ó–∞–≥—Ä—É–∑–∫–∏</h2>
            <div id="progressBarContainer">
                <div id="progressBar" style="width: 0%;">0%</div>
            </div>
        </div>

        <hr>

        <div class="game-area">
            <h2>üöÄ –ú–∏–Ω–∏-–ò–≥—Ä–∞: –î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞ –ú–∞—Ç—Ä–∏—Ü—ã</h2>
            <p><strong>–¶–µ–ø–æ—á–∫–∞ (–ö–ª—é—á):</strong> <span id="targetSequence">...</span></p>
            <p>–í–≤–æ–¥: <span id="playerInput"></span></p>
            <p>–í—Ä–µ–º—è —Ä–∞—É–Ω–¥–∞: <span id="roundTimer">8</span> —Å</p>
            
            <div id="matrixGrid" class="matrix-grid">
                </div>

            <p id="gameMessage" class="message">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —è—á–µ–π–∫—É –¥–ª—è –Ω–∞—á–∞–ª–∞</p>
        </div>

    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle"></h2>
            <p id="modalMessage"></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ---
            const TOTAL_GAME_TIME = 120; // 2 –º–∏–Ω—É—Ç—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            
            // –ò–ó–ú–ï–ù–ï–ù–ò–ï: –í—Ä–µ–º—è —Ä–∞—É–Ω–¥–∞ —É–≤–µ–ª–∏—á–µ–Ω–æ –Ω–∞ 5 —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ 3, —Å—Ç–∞–ª–æ 8)
            const ROUND_TIME = 8;        
            
            const SYMBOLS = ['%', '&', '!', '?', '$', '#', '@', '^'];
            const GRID_SIZE = 16;        // 4x4
            const SEQUENCE_LENGTH = 3;   // –î–ª–∏–Ω–∞ —Ü–µ–ø–æ—á–∫–∏ (–∫–ª—é—á–∞)
            const WIN_INCREASE = 15;     // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞ –ø–æ–±–µ–¥—É
            const LOSE_DECREASE = 5;     // –£–º–µ–Ω—å—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ

            let globalTimeLeft = TOTAL_GAME_TIME;
            let progress = 0; // –ü—Ä–æ–≥—Ä–µ—Å—Å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
            let targetSequence = []; 
            let playerInput = [];    
            let globalTimerInterval;
            let roundTimerInterval;
            let isGameRunning = false;

            // --- DOM –≠–ª–µ–º–µ–Ω—Ç—ã ---
            const globalTimerEl = document.getElementById('globalTimer');
            const progressBarEl = document.getElementById('progressBar');
            const targetSequenceEl = document.getElementById('targetSequence');
            const playerInputEl = document.getElementById('playerInput');
            const roundTimerEl = document.getElementById('roundTimer');
            const matrixGridEl = document.getElementById('matrixGrid');
            const gameMessageEl = document.getElementById('gameMessage');
            const modalEl = document.getElementById('modal');
            const modalTitleEl = document.getElementById('modalTitle');
            const modalMessageEl = document.getElementById('modalMessage');

            // --- –§—É–Ω–∫—Ü–∏–∏ –ò–≥—Ä—ã ---

            function updateProgress(change) {
                progress += change;
                if (progress > 100) progress = 100;
                if (progress < 0) progress = 0;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
                progressBarEl.style.width = `${progress}%`;
                progressBarEl.textContent = `${Math.round(progress)}%`;

                if (progress >= 100) {
                    endGame(true); // –ü–æ–±–µ–¥–∞
                }
            }

            function generateMatrix() {
                matrixGridEl.innerHTML = '';
                
                // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è —Å–µ—Ç–∫–∏
                for (let i = 0; i < GRID_SIZE; i++) {
                    const randomSymbol = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
                    
                    const cell = document.createElement('div');
                    cell.classList.add('matrix-cell');
                    cell.textContent = randomSymbol;
                    cell.dataset.symbol = randomSymbol;
                    cell.addEventListener('click', handleCellClick);
                    matrixGridEl.appendChild(cell);
                }

                // 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ü–µ–ª–µ–≤—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–∫–ª—é—á)
                targetSequence = [];
                for (let i = 0; i < SEQUENCE_LENGTH; i++) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏–º–≤–æ–ª—ã –∏–∑ –≤—Å–µ–≥–æ –º–∞—Å—Å–∏–≤–∞ –¥–ª—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
                    targetSequence.push(SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)]);
                }
                targetSequenceEl.textContent = targetSequence.join(' - ');
            }

            function handleCellClick(event) {
                if (!isGameRunning) return;

                const clickedSymbol = event.target.dataset.symbol;
                playerInput.push(clickedSymbol);
                playerInputEl.textContent = playerInput.join(' ');
                
                const currentTargetSymbol = targetSequence[playerInput.length - 1];

                if (clickedSymbol !== currentTargetSymbol) {
                    // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–≤–∞–ª
                    endRound(false, '‚õî –û—à–∏–±–∫–∞ –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏!');
                    return;
                }

                if (playerInput.length === SEQUENCE_LENGTH) {
                    // –¶–µ–ø–æ—á–∫–∞ –≤–≤–µ–¥–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
                    endRound(true, '‚úÖ –£—Å–ø–µ—à–Ω–∞—è –î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞!');
                }
            }
            
            // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¢–∞–π–º–µ—Ä–∞–º–∏ –∏ –†–∞—É–Ω–¥–∞–º–∏ ---

            function startGlobalTimer() {
                if (globalTimerInterval) clearInterval(globalTimerInterval);
                globalTimerInterval = setInterval(() => {
                    globalTimeLeft--;
                    globalTimerEl.textContent = globalTimeLeft;

                    if (globalTimeLeft <= 0) {
                        clearInterval(globalTimerInterval);
                        if (progress < 100) {
                           endGame(false); // –ü—Ä–æ–∏–≥—Ä—ã—à –ø–æ –≤—Ä–µ–º–µ–Ω–∏
                        }
                    }
                }, 1000);
            }

            function startRoundTimer() {
                let roundTimeLeft = ROUND_TIME;
                roundTimerEl.textContent = roundTimeLeft;
                
                if (roundTimerInterval) clearInterval(roundTimerInterval);
                roundTimerInterval = setInterval(() => {
                    roundTimeLeft--;
                    roundTimerEl.textContent = roundTimeLeft;

                    if (roundTimeLeft <= 0) {
                        endRound(false, '‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞—É–Ω–¥–∞ –∏—Å—Ç–µ–∫–ª–æ!');
                    }
                }, 1000);
            }
            
            function endRound(isWin, message) {
                // –ï—Å–ª–∏ —Ä–∞—É–Ω–¥ —É–∂–µ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ —Ç–∞–π–º–∞—É—Ç—É –∏ –∫–ª–∏–∫—É), –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
                if (!isGameRunning) return; 
                clearInterval(roundTimerInterval);
                
                gameMessageEl.textContent = message;
                playerInput = [];
                playerInputEl.textContent = '';
                isGameRunning = false; // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –¥–æ –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞

                if (isWin) {
                    updateProgress(WIN_INCREASE);
                    gameMessageEl.style.color = '#00ff00';
                } else {
                    updateProgress(-LOSE_DECREASE);
                    gameMessageEl.style.color = '#ff0000';
                }

                // –ï—Å–ª–∏ –∏–≥—Ä–∞ –µ—â–µ –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–∏
                if (globalTimeLeft > 0 && progress < 100) {
                    // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
                    setTimeout(newRound, 1500);
                }
            }

            function newRound() {
                if (globalTimeLeft <= 0 || progress >= 100) return;

                gameMessageEl.textContent = '–í–∑–ª–æ–º –∞–∫—Ç–∏–≤–µ–Ω. –í–≤–µ–¥–∏—Ç–µ –¶–µ–ø–æ—á–∫—É!';
                gameMessageEl.style.color = '#00ffff';
                generateMatrix();
                startRoundTimer();
                isGameRunning = true;
            }

            function endGame(isWin) {
                clearInterval(globalTimerInterval);
                clearInterval(roundTimerInterval);
                isGameRunning = false;
                
                modalEl.style.display = 'flex';
                
                if (isWin) {
                    modalTitleEl.textContent = 'ü•≥ –û—Ç–ª–∏—á–Ω–æ!';
                    modalMessageEl.innerHTML = '–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—é "–í–∫–ª—é—á–µ–Ω–∏–µ –í—ã—à–∫–∏".<br>–ü–µ—Ä–µ–¥–∞–π—Ç–µ –ö–∞–∑–∞—Ö—É —Å–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ - <span class="secret-word">–ú—ã—à–∫–∞</span>';
                } else {
                    modalTitleEl.textContent = 'üòû –í–∑–ª–æ–º –ü—Ä–æ–≤–∞–ª–µ–Ω';
                    modalMessageEl.textContent = '–í—Ä–µ–º—è –≤—ã—à–ª–æ –∏–ª–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–æ–∫. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞.';
                }
            }

            // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
            updateProgress(0); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            startGlobalTimer();
            newRound();
        });
    </script>
</body>
</html>